<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebEngage Personalization Simulator</title>
  <style>
    :root {
      --primary: #2563EB;
      --primary-dark: #1E40AF;
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --bg: #F9FAFB;
      --card: #FFFFFF;
      --border: #E5E7EB;
      --text: #111827;
      --text-muted: #6B7280;
      --text-light: #9CA3AF;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      --radius: 8px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    .container { max-width: 1600px; margin: 0 auto; padding: 0 24px; }

    header {
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 18px;
      color: var(--primary);
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 8px;
      display: grid;
      place-items: center;
      color: white;
      font-weight: 700;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 320px 1fr 360px;
      gap: 24px;
      margin: 24px 0;
      align-items: start;
    }

    .control-panel, .analytics-panel {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      position: sticky;
      top: 88px;
      max-height: calc(100vh - 110px);
      overflow-y: auto;
    }

    .panel-section {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border);
    }

    .panel-section:last-child { border-bottom: none; margin-bottom: 0; }

    .section-title {
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group:last-child { margin-bottom: 0; }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }

    select, input[type="text"], input[type="number"], input[type="email"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      background: white;
      transition: all 0.15s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: white;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    .simulator {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    }

    .browser-chrome {
      background: #F3F4F6;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .browser-dots {
      display: flex;
      gap: 6px;
    }

    .browser-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .browser-dot:nth-child(1) { background: #EF4444; }
    .browser-dot:nth-child(2) { background: #F59E0B; }
    .browser-dot:nth-child(3) { background: #10B981; }

    .browser-url {
      flex: 1;
      background: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      color: var(--text-muted);
      border: 1px solid var(--border);
    }

    .website {
      min-height: 600px;
    }

    .site-header {
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .site-logo {
      font-weight: 700;
      font-size: 20px;
    }

    .site-nav {
      display: flex;
      gap: 24px;
      font-size: 14px;
    }

    .site-nav a {
      text-decoration: none;
      color: var(--text);
      font-weight: 500;
    }

    .site-user {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .hero-banner {
      padding: 48px 24px;
      background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
      color: white;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero-banner h1 {
      font-size: 36px;
      margin-bottom: 12px;
      font-weight: 700;
    }

    .hero-banner p {
      font-size: 18px;
      opacity: 0.95;
      margin-bottom: 24px;
    }

    .hero-cta {
      background: white;
      color: var(--primary);
      padding: 14px 32px;
      border-radius: 8px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .site-content {
      padding: 32px 24px;
    }

    .content-section {
      margin-bottom: 40px;
    }

    .content-section:last-child { margin-bottom: 0; }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .section-header h2 {
      font-size: 24px;
      font-weight: 700;
    }

    .personalization-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: #DBEAFE;
      color: var(--primary);
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.2s;
      position: relative;
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .product-image {
      width: 100%;
      height: 200px;
      background: #F3F4F6;
      display: grid;
      place-items: center;
      font-size: 48px;
    }

    .product-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .badge-trending { background: #FEF3C7; color: #92400E; }
    .badge-new { background: #DBEAFE; color: #1E40AF; }
    .badge-sale { background: #FEE2E2; color: #991B1B; }
    .badge-recommended { background: #D1FAE5; color: #065F46; }

    .product-info {
      padding: 16px;
    }

    .product-name {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 15px;
    }

    .product-price {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .product-rating {
      font-size: 13px;
      color: var(--text-muted);
    }

    .product-meta {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .meta-tag {
      font-size: 11px;
      padding: 2px 8px;
      background: #F3F4F6;
      border-radius: 4px;
      color: var(--text-muted);
    }

    .promo-banner {
      padding: 20px 24px;
      border-radius: var(--radius);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .banner-offer {
      background: linear-gradient(135deg, #10B981, #059669);
      color: white;
    }

    .banner-cart {
      background: linear-gradient(135deg, #F59E0B, #D97706);
      color: white;
    }

    .banner-loyalty {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
      color: white;
    }

    .banner-content h3 {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .banner-content p {
      opacity: 0.95;
      font-size: 14px;
    }

    .analytics-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text);
    }

    .metric-grid {
      display: grid;
      gap: 12px;
    }

    .metric-card {
      background: var(--bg);
      padding: 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .metric-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
      font-weight: 500;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
    }

    .metric-change {
      font-size: 12px;
      font-weight: 600;
      margin-top: 4px;
    }

    .metric-change.positive { color: var(--success); }
    .metric-change.negative { color: var(--danger); }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s;
    }

    .segment-tag {
      display: inline-block;
      padding: 6px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .propensity-list {
      list-style: none;
    }

    .propensity-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }

    .propensity-item:last-child { border-bottom: none; }

    .propensity-label {
      font-weight: 500;
    }

    .propensity-score {
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .score-high { background: #D1FAE5; color: #065F46; }
    .score-medium { background: #FEF3C7; color: #92400E; }
    .score-low { background: #FEE2E2; color: #991B1B; }

    .trigger-log {
      font-size: 12px;
      padding: 8px;
      background: #F9FAFB;
      border-left: 3px solid var(--primary);
      margin-bottom: 8px;
      border-radius: 4px;
    }

    .trigger-time {
      color: var(--text-muted);
      font-weight: 600;
    }

    .active-personalization {
      font-size: 13px;
      padding: 6px 10px;
      background: var(--bg);
      border-radius: 4px;
      margin-bottom: 6px;
      border-left: 3px solid var(--primary);
    }

    @media (max-width: 1400px) {
      .main-grid {
        grid-template-columns: 280px 1fr 320px;
      }
    }

    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 1fr;
      }

      .control-panel, .analytics-panel {
        position: static;
        max-height: none;
      }
    }

    @media (max-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }

      .site-nav {
        display: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">WE</div>
          <span>WebEngage Personalization Simulator</span>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" id="resetBtn">Reset</button>
          <button class="btn btn-primary btn-sm" id="shareBtn">Share Config</button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="main-grid">
      <aside class="control-panel">
        <div class="panel-section">
          <div class="section-title">Industry & Brand</div>
          <div class="form-group">
            <label>Industry Vertical</label>
            <select id="industry">
              <option value="retail">Retail & Fashion</option>
              <option value="ecommerce">E-commerce Marketplace</option>
              <option value="travel">Travel & Hospitality</option>
              <option value="fintech">Fintech & Banking</option>
              <option value="edtech">EdTech & Learning</option>
              <option value="food">Food & Delivery</option>
              <option value="health">Healthcare & Wellness</option>
            </select>
          </div>
          <div class="form-group">
            <label>Brand Name</label>
            <input type="text" id="brandName" value="AcmeCo" placeholder="Enter brand name">
          </div>
        </div>

        <div class="panel-section">
          <div class="section-title">User Profile</div>
          <div class="form-group">
            <label>Lifecycle Stage</label>
            <select id="userStage">
              <option value="anonymous">Anonymous Visitor</option>
              <option value="new">New User</option>
              <option value="active">Active User</option>
              <option value="engaged">Highly Engaged</option>
              <option value="dormant">Dormant</option>
              <option value="churned">Churned</option>
            </select>
          </div>
          <div class="form-group">
            <label>User Email</label>
            <input type="email" id="userEmail" placeholder="user@example.com">
          </div>
          <div class="form-group">
            <label>Session Count</label>
            <input type="number" id="sessionCount" value="1" min="1" max="100">
          </div>
          <div class="form-group">
            <label>Days Since Last Visit</label>
            <input type="number" id="daysSinceVisit" value="0" min="0" max="365">
          </div>
          <div class="form-group">
            <label>Total Purchases</label>
            <input type="number" id="purchaseCount" value="0" min="0" max="50">
          </div>
          <div class="form-group">
            <label>Lifetime Value</label>
            <input type="number" id="ltv" value="0" min="0" step="100" placeholder="‚Çπ">
          </div>
        </div>

        <div class="panel-section">
          <div class="section-title">Affinity & Behavior</div>
          <div class="form-group">
            <label>Price Sensitivity</label>
            <select id="priceSensitivity">
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <div class="form-group">
            <label>Category Affinity</label>
            <select id="categoryAffinity">
              <option value="none">None</option>
              <option value="electronics">Electronics</option>
              <option value="fashion">Fashion</option>
              <option value="home">Home</option>
              <option value="beauty">Beauty</option>
              <option value="sports">Sports</option>
            </select>
          </div>
          <div class="form-group">
            <label>Browse Behavior</label>
            <select id="browseBehavior">
              <option value="casual">Casual Browser</option>
              <option value="focused">Focused Shopper</option>
              <option value="research">Research Mode</option>
              <option value="cart">Cart Abandoner</option>
            </select>
          </div>
        </div>

        <div class="panel-section">
          <div class="section-title">Personalization Engine</div>
          <div class="form-group">
            <label>Recommendation Algorithm</label>
            <select id="recoAlgo">
              <option value="collaborative">Collaborative Filtering</option>
              <option value="content">Content-Based</option>
              <option value="hybrid">Hybrid</option>
              <option value="trending">Trending</option>
              <option value="affinity">Affinity-Based</option>
            </select>
          </div>
          <div class="form-group">
            <label>Personalization Level</label>
            <select id="personalizationLevel">
              <option value="none">None</option>
              <option value="basic">Basic</option>
              <option value="advanced">Advanced</option>
              <option value="predictive">Predictive</option>
            </select>
          </div>
        </div>

        <button class="btn btn-primary" style="width: 100%; margin-top: 12px;" id="applyBtn">Apply Changes</button>
      </aside>

      <main class="simulator">
        <div class="browser-chrome">
          <div class="browser-dots">
            <div class="browser-dot"></div>
            <div class="browser-dot"></div>
            <div class="browser-dot"></div>
          </div>
          <div class="browser-url" id="browserUrl">https://www.acmeco.com</div>
        </div>

        <div class="website">
          <div class="site-header">
            <div class="site-logo" id="siteLogo">AcmeCo</div>
            <div class="site-nav">
              <a href="#">Shop</a>
              <a href="#">Categories</a>
              <a href="#">Deals</a>
              <a href="#">About</a>
            </div>
            <div class="site-user" id="siteUser">
              <span>Guest</span>
            </div>
          </div>

          <div id="heroBanner"></div>

          <div id="promoBanners"></div>

          <div class="site-content">
            <div id="contentSections"></div>
          </div>
        </div>
      </main>

      <aside class="analytics-panel">
        <div class="panel-section">
          <div class="analytics-title">User Insights</div>
          <div class="segment-tag" id="userSegment">Anonymous</div>
          <div class="metric-grid">
            <div class="metric-card">
              <div class="metric-label">Engagement Score</div>
              <div class="metric-value" id="engagementScore">0</div>
              <div class="progress-bar">
                <div class="progress-fill" id="engagementBar" style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel-section">
          <div class="analytics-title">Propensity Scores</div>
          <ul class="propensity-list" id="propensityList"></ul>
        </div>

        <div class="panel-section">
          <div class="analytics-title">Active Personalizations</div>
          <div id="activePersonalizations"></div>
        </div>

        <div class="panel-section">
          <div class="analytics-title">Real-time Triggers</div>
          <div id="triggerLog"></div>
        </div>

        <div class="panel-section">
          <div class="analytics-title">Predicted Metrics</div>
          <div class="metric-grid" id="predictedMetrics"></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const CONFIG = {
      industry: 'retail',
      brandName: 'AcmeCo',
      userStage: 'anonymous',
      userEmail: '',
      sessionCount: 1,
      daysSinceVisit: 0,
      purchaseCount: 0,
      ltv: 0,
      priceSensitivity: 'medium',
      categoryAffinity: 'none',
      browseBehavior: 'casual',
      recoAlgo: 'hybrid',
      personalizationLevel: 'advanced'
    };

    const PRODUCTS = {
      retail: [
        { id: 1, name: 'Wireless Headphones', price: 2999, rating: 4.5, category: 'electronics', tags: ['trending', 'premium'] },
        { id: 2, name: 'Smart Watch Series 5', price: 8999, rating: 4.7, category: 'electronics', tags: ['new', 'premium'] },
        { id: 3, name: 'Cotton T-Shirt', price: 599, rating: 4.2, category: 'fashion', tags: ['sale', 'value'] },
        { id: 4, name: 'Running Shoes', price: 3499, rating: 4.6, category: 'sports', tags: ['trending'] },
        { id: 5, name: 'Yoga Mat Premium', price: 1299, rating: 4.4, category: 'sports', tags: ['recommended'] },
        { id: 6, name: 'Coffee Maker', price: 4999, rating: 4.3, category: 'home', tags: ['new'] },
        { id: 7, name: 'Face Serum', price: 1499, rating: 4.8, category: 'beauty', tags: ['trending', 'recommended'] },
        { id: 8, name: 'Laptop Backpack', price: 1899, rating: 4.5, category: 'electronics', tags: ['value'] },
      ]
    };

    function init() {
      loadFromURL();
      bindEvents();
      render();
    }

    function loadFromURL() {
      const params = new URLSearchParams(window.location.search);
      Object.keys(CONFIG).forEach(key => {
        const value = params.get(key);
        if (value !== null) {
          if (['sessionCount', 'daysSinceVisit', 'purchaseCount', 'ltv'].includes(key)) {
            CONFIG[key] = parseInt(value) || 0;
          } else {
            CONFIG[key] = value;
          }
        }
      });

      Object.keys(CONFIG).forEach(key => {
        const el = document.getElementById(key);
        if (el) el.value = CONFIG[key];
      });
    }

    function bindEvents() {
      document.getElementById('applyBtn').addEventListener('click', () => {
        updateConfig();
        render();
        updateURL();
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        Object.assign(CONFIG, {
          industry: 'retail',
          brandName: 'AcmeCo',
          userStage: 'anonymous',
          userEmail: '',
          sessionCount: 1,
          daysSinceVisit: 0,
          purchaseCount: 0,
          ltv: 0,
          priceSensitivity: 'medium',
          categoryAffinity: 'none',
          browseBehavior: 'casual',
          recoAlgo: 'hybrid',
          personalizationLevel: 'advanced'
        });

        Object.keys(CONFIG).forEach(key => {
          const el = document.getElementById(key);
          if (el) el.value = CONFIG[key];
        });

        render();
        updateURL();
      });

      document.getElementById('shareBtn').addEventListener('click', () => {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
          alert('Configuration URL copied to clipboard');
        }).catch(() => {
          prompt('Copy this URL:', url);
        });
      });
    }

    function updateConfig() {
      Object.keys(CONFIG).forEach(key => {
        const el = document.getElementById(key);
        if (el) {
          if (['sessionCount', 'daysSinceVisit', 'purchaseCount', 'ltv'].includes(key)) {
            CONFIG[key] = parseInt(el.value) || 0;
          } else {
            CONFIG[key] = el.value;
          }
        }
      });
    }

    function updateURL() {
      const params = new URLSearchParams();
      Object.entries(CONFIG).forEach(([key, value]) => {
        if (value) params.set(key, value);
      });
      const newURL = `${window.location.pathname}?${params.toString()}`;
      window.history.replaceState({}, '', newURL);
    }

    function render() {
      renderBrandElements();
      renderHeroBanner();
      renderPromoBanners();
      renderContentSections();
      renderAnalytics();
      logTrigger('Page Loaded', 'User landed on homepage');
    }

    function renderBrandElements() {
      document.getElementById('siteLogo').textContent = CONFIG.brandName;
      document.getElementById('browserUrl').textContent = `https://www.${CONFIG.brandName.toLowerCase().replace(/\s+/g, '')}.com`;

      const userDisplay = document.getElementById('siteUser');
      if (CONFIG.userEmail) {
        userDisplay.textContent = CONFIG.userEmail.split('@')[0];
      } else if (CONFIG.userStage !== 'anonymous') {
        userDisplay.textContent = 'User';
      } else {
        userDisplay.textContent = 'Guest';
      }
    }

    function renderHeroBanner() {
      const heroBanner = document.getElementById('heroBanner');
      const personalization = getHeroPersonalization();

      heroBanner.innerHTML = `
        <div class="hero-banner" style="${personalization.gradient}">
          <h1>${personalization.title}</h1>
          <p>${personalization.subtitle}</p>
          <button class="hero-cta">${personalization.cta}</button>
        </div>
      `;
    }

    function getHeroPersonalization() {
      const defaults = {
        gradient: 'background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);',
        title: `Welcome to ${CONFIG.brandName}`,
        subtitle: 'Discover amazing products tailored for you',
        cta: 'Shop Now'
      };

      if (CONFIG.personalizationLevel === 'none') return defaults;

      if (CONFIG.userStage === 'churned') {
        return {
          gradient: 'background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);',
          title: `We Miss You! Come Back for 40% Off`,
          subtitle: 'Exclusive offer just for you - Limited time only',
          cta: 'Claim Your Discount'
        };
      }

      if (CONFIG.userStage === 'dormant') {
        return {
          gradient: 'background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);',
          title: `${CONFIG.userEmail ? CONFIG.userEmail.split('@')[0] + ', ' : ''}Special Rewards Waiting!`,
          subtitle: 'Get 25% off on your favorite categories',
          cta: 'Unlock Rewards'
        };
      }

      if (CONFIG.browseBehavior === 'cart') {
        return {
          gradient: 'background: linear-gradient(135deg, #10B981 0%, #059669 100%);',
          title: 'Your Cart Misses You!',
          subtitle: 'Complete your purchase and get free shipping',
          cta: 'View Cart'
        };
      }

      if (CONFIG.purchaseCount > 5) {
        return {
          gradient: 'background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);',
          title: `VIP Member Exclusive: ${CONFIG.userEmail ? CONFIG.userEmail.split('@')[0] : 'Welcome Back'}`,
          subtitle: 'New arrivals in your favorite categories',
          cta: 'Shop VIP Deals'
        };
      }

      if (CONFIG.priceSensitivity === 'high') {
        return {
          gradient: 'background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);',
          title: 'Mega Sale: Up to 60% Off!',
          subtitle: 'Best deals on trending products',
          cta: 'Grab Deals'
        };
      }

      if (CONFIG.categoryAffinity !== 'none') {
        const categoryNames = {
          electronics: 'Tech Gadgets',
          fashion: 'Fashion',
          home: 'Home Essentials',
          beauty: 'Beauty Products',
          sports: 'Sports & Fitness'
        };
        return {
          gradient: 'background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);',
          title: `New in ${categoryNames[CONFIG.categoryAffinity]}`,
          subtitle: 'Handpicked items based on your interests',
          cta: 'Explore Now'
        };
      }

      return defaults;
    }

    function renderPromoBanners() {
      const container = document.getElementById('promoBanners');
      const banners = [];

      if (CONFIG.personalizationLevel === 'none') {
        container.innerHTML = '';
        return;
      }

      if (CONFIG.browseBehavior === 'cart' && CONFIG.personalizationLevel !== 'none') {
        banners.push({
          class: 'banner-cart',
          title: 'Complete Your Purchase',
          text: 'Your cart has 3 items waiting. Checkout now for free shipping!',
          cta: 'View Cart'
        });
      }

      if (CONFIG.purchaseCount >= 3 && CONFIG.userStage !== 'churned') {
        banners.push({
          class: 'banner-loyalty',
          title: 'Loyalty Rewards',
          text: `You have 2,500 points. Redeem for instant discounts!`,
          cta: 'View Rewards'
        });
      }

      if (CONFIG.daysSinceVisit > 7 && CONFIG.userStage !== 'anonymous') {
        banners.push({
          class: 'banner-offer',
          title: 'Welcome Back Offer',
          text: 'Get 20% off on your next purchase - Valid for 24 hours',
          cta: 'Activate Offer'
        });
      }

      container.innerHTML = banners.map(b => `
        <div class="promo-banner ${b.class}">
          <div class="banner-content">
            <h3>${b.title}</h3>
            <p>${b.text}</p>
          </div>
          <button class="btn btn-primary">${b.cta}</button>
        </div>
      `).join('');
    }

    function renderContentSections() {
      const container = document.getElementById('contentSections');
      const sections = getContentSections();

      container.innerHTML = sections.map(section => `
        <div class="content-section">
          <div class="section-header">
            <h2>${section.title}</h2>
            ${section.personalized ? '<span class="personalization-badge">Personalized</span>' : ''}
          </div>
          <div class="product-grid">
            ${section.products.map(renderProduct).join('')}
          </div>
        </div>
      `).join('');
    }

    function getContentSections() {
      const products = PRODUCTS[CONFIG.industry] || PRODUCTS.retail;
      const sections = [];

      if (CONFIG.personalizationLevel === 'none') {
        sections.push({
          title: 'Featured Products',
          products: products.slice(0, 4),
          personalized: false
        });
        sections.push({
          title: 'More Products',
          products: products.slice(4, 8),
          personalized: false
        });
        return sections;
      }

      const recommendedProducts = getRecommendedProducts(products);
      sections.push({
        title: getRecommendationTitle(),
        products: recommendedProducts,
        personalized: true
      });

      if (CONFIG.browseBehavior === 'research') {
        const topRated = [...products].sort((a, b) => b.rating - a.rating).slice(0, 4);
        sections.push({
          title: 'Top Rated Products',
          products: topRated,
          personalized: true
        });
      }

      if (CONFIG.categoryAffinity !== 'none') {
        const categoryProducts = products.filter(p => p.category === CONFIG.categoryAffinity).slice(0, 4);
        if (categoryProducts.length > 0) {
          sections.push({
            title: `More in ${CONFIG.categoryAffinity.charAt(0).toUpperCase() + CONFIG.categoryAffinity.slice(1)}`,
            products: categoryProducts,
            personalized: true
          });
        }
      }

      const trending = products.filter(p => p.tags.includes('trending')).slice(0, 4);
      if (trending.length > 0) {
        sections.push({
          title: 'Trending Now',
          products: trending,
          personalized: false
        });
      }

      return sections;
    }

    function getRecommendationTitle() {
      if (CONFIG.recoAlgo === 'trending') return 'Trending Products';
      if (CONFIG.recoAlgo === 'affinity') return 'Based on Your Interests';
      if (CONFIG.recoAlgo === 'collaborative') return 'Customers Like You Bought';
      if (CONFIG.recoAlgo === 'content') return 'Similar to What You Viewed';
      return 'Recommended for You';
    }

    function getRecommendedProducts(products) {
      let scored = products.map(p => ({ ...p, score: 0 }));

      if (CONFIG.categoryAffinity !== 'none') {
        scored = scored.map(p => ({
          ...p,
          score: p.score + (p.category === CONFIG.categoryAffinity ? 50 : 0)
        }));
      }

      if (CONFIG.priceSensitivity === 'high') {
        scored = scored.map(p => ({
          ...p,
          score: p.score + (p.tags.includes('sale') || p.tags.includes('value') ? 30 : 0) - (p.price / 100)
        }));
      } else if (CONFIG.priceSensitivity === 'low') {
        scored = scored.map(p => ({
          ...p,
          score: p.score + (p.tags.includes('premium') ? 40 : 0) + (p.price / 200)
        }));
      }

      if (CONFIG.recoAlgo === 'trending') {
        scored = scored.map(p => ({
          ...p,
          score: p.score + (p.tags.includes('trending') ? 60 : 0)
        }));
      }

      scored = scored.map(p => ({
        ...p,
        score: p.score + (p.rating * 10) + Math.random() * 20
      }));

      return scored.sort((a, b) => b.score - a.score).slice(0, 4);
    }

    function renderProduct(product) {
      const badge = product.tags[0] || '';
      const badgeClass = badge ? `badge-${badge}` : '';

      return `
        <div class="product-card">
          ${badge ? `<div class="product-badge ${badgeClass}">${badge}</div>` : ''}
          <div class="product-image">üéÅ</div>
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-price">‚Çπ${product.price.toLocaleString('en-IN')}</div>
            <div class="product-rating">‚≠ê ${product.rating} (${Math.floor(Math.random() * 500 + 100)} reviews)</div>
            <div class="product-meta">
              ${product.tags.slice(1).map(tag => `<span class="meta-tag">${tag}</span>`).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function renderAnalytics() {
      renderUserSegment();
      renderEngagementScore();
      renderPropensityScores();
      renderActivePersonalizations();
      renderPredictedMetrics();
    }

    function renderUserSegment() {
      const segmentNames = {
        anonymous: 'Anonymous Visitor',
        new: 'New User',
        active: 'Active Customer',
        engaged: 'Highly Engaged',
        dormant: 'At-Risk',
        churned: 'Churned User'
      };
      document.getElementById('userSegment').textContent = segmentNames[CONFIG.userStage];
    }

    function renderEngagementScore() {
      let score = 0;
      score += CONFIG.sessionCount * 5;
      score += CONFIG.purchaseCount * 15;
      score += Math.max(0, (30 - CONFIG.daysSinceVisit) * 2);
      score += (CONFIG.ltv / 100);
      score = Math.min(100, Math.round(score));

      document.getElementById('engagementScore').textContent = score;
      document.getElementById('engagementBar').style.width = `${score}%`;
    }

    function renderPropensityScores() {
      const propensities = calculatePropensities();
      const html = propensities.map(p => `
        <li class="propensity-item">
          <span class="propensity-label">${p.label}</span>
          <span class="propensity-score ${p.class}">${p.score}%</span>
        </li>
      `).join('');
      document.getElementById('propensityList').innerHTML = html;
    }

    function calculatePropensities() {
      const propensities = [];

      let purchaseScore = 30;
      if (CONFIG.userStage === 'engaged') purchaseScore = 85;
      else if (CONFIG.userStage === 'active') purchaseScore = 65;
      else if (CONFIG.browseBehavior === 'focused') purchaseScore = 70;
      else if (CONFIG.browseBehavior === 'cart') purchaseScore = 80;
      else if (CONFIG.userStage === 'churned') purchaseScore = 15;
      propensities.push({
        label: 'Purchase Propensity',
        score: purchaseScore,
        class: purchaseScore >= 70 ? 'score-high' : purchaseScore >= 40 ? 'score-medium' : 'score-low'
      });

      let churnScore = 20;
      if (CONFIG.userStage === 'dormant') churnScore = 65;
      else if (CONFIG.userStage === 'churned') churnScore = 90;
      else if (CONFIG.daysSinceVisit > 30) churnScore = 55;
      else if (CONFIG.userStage === 'engaged') churnScore = 10;
      propensities.push({
        label: 'Churn Risk',
        score: churnScore,
        class: churnScore >= 60 ? 'score-high' : churnScore >= 30 ? 'score-medium' : 'score-low'
      });

      let upsellScore = 25;
      if (CONFIG.purchaseCount > 5) upsellScore = 75;
      else if (CONFIG.priceSensitivity === 'low') upsellScore = 80;
      else if (CONFIG.ltv > 10000) upsellScore = 85;
      propensities.push({
        label: 'Upsell Potential',
        score: upsellScore,
        class: upsellScore >= 70 ? 'score-high' : upsellScore >= 40 ? 'score-medium' : 'score-low'
      });

      return propensities;
    }

    function renderActivePersonalizations() {
      const personalizations = [];

      if (CONFIG.personalizationLevel === 'none') {
        document.getElementById('activePersonalizations').innerHTML = '<p style="font-size: 13px; color: var(--text-muted);">No personalization active</p>';
        return;
      }

      personalizations.push('Dynamic Hero Banner');
      personalizations.push(`${getRecommendationTitle()}`);

      if (CONFIG.browseBehavior === 'cart') personalizations.push('Cart Recovery Banner');
      if (CONFIG.purchaseCount >= 3) personalizations.push('Loyalty Rewards Widget');
      if (CONFIG.categoryAffinity !== 'none') personalizations.push('Category-Based Filtering');
      if (CONFIG.priceSensitivity === 'high') personalizations.push('Deal Highlighting');

      const html = personalizations.map(p => `
        <div class="active-personalization">‚úì ${p}</div>
      `).join('');

      document.getElementById('activePersonalizations').innerHTML = html;
    }

    function renderPredictedMetrics() {
      const metrics = [];

      const cvr = CONFIG.userStage === 'engaged' ? 8.5 : CONFIG.userStage === 'active' ? 4.2 : 1.8;
      metrics.push({
        label: 'Predicted CVR',
        value: `${cvr}%`,
        change: CONFIG.personalizationLevel !== 'none' ? '+2.3%' : null,
        positive: true
      });

      const aov = CONFIG.priceSensitivity === 'low' ? 4500 : CONFIG.priceSensitivity === 'medium' ? 2800 : 1500;
      metrics.push({
        label: 'Expected AOV',
        value: `‚Çπ${aov.toLocaleString('en-IN')}`,
        change: CONFIG.personalizationLevel === 'predictive' ? '+15%' : null,
        positive: true
      });

      const html = metrics.map(m => `
        <div class="metric-card">
          <div class="metric-label">${m.label}</div>
          <div style="display: flex; align-items: baseline; gap: 8px;">
            <div style="font-size: 18px; font-weight: 700;">${m.value}</div>
            ${m.change ? `<div class="metric-change ${m.positive ? 'positive' : 'negative'}">${m.change}</div>` : ''}
          </div>
        </div>
      `).join('');

      document.getElementById('predictedMetrics').innerHTML = html;
    }

    const triggerHistory = [];
    function logTrigger(event, description) {
      const now = new Date();
      const time = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

      triggerHistory.unshift({ time, event, description });
      if (triggerHistory.length > 5) triggerHistory.pop();

      const html = triggerHistory.map(t => `
        <div class="trigger-log">
          <div class="trigger-time">${t.time}</div>
          <div><strong>${t.event}</strong></div>
          <div style="font-size: 11px; color: var(--text-muted);">${t.description}</div>
        </div>
      `).join('');

      document.getElementById('triggerLog').innerHTML = html || '<p style="font-size: 13px; color: var(--text-muted);">No recent triggers</p>';
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
